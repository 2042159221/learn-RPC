# Ming RPC Framework æ¶ˆè´¹æ–¹è°ƒç”¨å®ç°è¯¦è§£

## ğŸ“– æ¦‚è¿°

åœ¨Ming RPC Frameworkä¸­ï¼Œæ¶ˆè´¹æ–¹ï¼ˆå®¢æˆ·ç«¯ï¼‰é€šè¿‡JDKåŠ¨æ€ä»£ç†å’Œå·¥å‚æ¨¡å¼å®ç°äº†é€æ˜åŒ–çš„è¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚æ¶ˆè´¹è€…å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œæ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ã€åºåˆ—åŒ–ã€è´Ÿè½½å‡è¡¡ç­‰å¤æ‚é€»è¾‘éƒ½è¢«å°è£…åœ¨ä»£ç†å±‚ä¸­ã€‚

### ğŸ¯ æ ¸å¿ƒé—®é¢˜
> åœ¨Ming RPC Frameworkä¸­æ˜¯å¦‚ä½•å®ç°æ¶ˆè´¹æ–¹è°ƒç”¨çš„ï¼Ÿä¸ºä»€ä¹ˆé€‰ç”¨JDKåŠ¨æ€ä»£ç†å’Œå·¥å‚æ¨¡å¼ï¼Ÿ

### ğŸ’¡ æ¶ˆè´¹æ–¹è°ƒç”¨çš„ä»·å€¼
1. **é€æ˜åŒ–è°ƒç”¨**: åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡
2. **å¤æ‚æ€§å°è£…**: éšè—ç½‘ç»œé€šä¿¡ã€åºåˆ—åŒ–ç­‰åº•å±‚ç»†èŠ‚
3. **ç»Ÿä¸€å¤„ç†**: åœ¨ä»£ç†å±‚ç»Ÿä¸€å¤„ç†è´Ÿè½½å‡è¡¡ã€å®¹é”™ã€é‡è¯•ç­‰é€»è¾‘
4. **ç±»å‹å®‰å…¨**: ä¿æŒå¼ºç±»å‹æ£€æŸ¥ï¼Œé¿å…è¿è¡Œæ—¶ç±»å‹é”™è¯¯

### ğŸ”„ æ¶ˆè´¹æ–¹è°ƒç”¨æµç¨‹å›¾
```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯ä»£ç 
    participant Factory as ServiceProxyFactory
    participant Proxy as åŠ¨æ€ä»£ç†
    participant Registry as æ³¨å†Œä¸­å¿ƒ
    participant LoadBalancer as è´Ÿè½½å‡è¡¡å™¨
    participant Network as ç½‘ç»œé€šä¿¡
    participant Provider as æœåŠ¡æä¾›è€…

    Client->>Factory: getProxy(UserService.class)
    Factory->>Proxy: åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡
    Factory-->>Client: è¿”å›ä»£ç†å¯¹è±¡

    Client->>Proxy: userService.getUser(user)
    Proxy->>Registry: æœåŠ¡å‘ç°
    Registry-->>Proxy: è¿”å›æœåŠ¡åˆ—è¡¨
    Proxy->>LoadBalancer: è´Ÿè½½å‡è¡¡é€‰æ‹©
    LoadBalancer-->>Proxy: è¿”å›ç›®æ ‡æœåŠ¡
    Proxy->>Network: å‘é€RPCè¯·æ±‚
    Network->>Provider: è½¬å‘è¯·æ±‚
    Provider-->>Network: è¿”å›å“åº”
    Network-->>Proxy: è¿”å›å“åº”
    Proxy-->>Client: è¿”å›ç»“æœ
```

## ğŸš€ 1. æ¶ˆè´¹æ–¹è°ƒç”¨æ€»ä½“æµç¨‹

### 1.1 æ ¸å¿ƒæµç¨‹æ­¥éª¤

Ming RPC Frameworkä¸­æ¶ˆè´¹æ–¹è°ƒç”¨è¿œç¨‹æœåŠ¡çš„å®Œæ•´æµç¨‹ï¼š

1. **ä»£ç†å¯¹è±¡è·å–**: é€šè¿‡ServiceProxyFactoryè·å–æœåŠ¡æ¥å£çš„åŠ¨æ€ä»£ç†å¯¹è±¡
2. **æ–¹æ³•è°ƒç”¨æ‹¦æˆª**: ä»£ç†å¯¹è±¡æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œè½¬æ¢ä¸ºRPCè¯·æ±‚
3. **æœåŠ¡å‘ç°**: ä»æ³¨å†Œä¸­å¿ƒè·å–å¯ç”¨çš„æœåŠ¡æä¾›è€…åˆ—è¡¨
4. **è´Ÿè½½å‡è¡¡**: æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©ç›®æ ‡æœåŠ¡å®ä¾‹
5. **ç½‘ç»œé€šä¿¡**: é€šè¿‡TCP/HTTPåè®®å‘é€RPCè¯·æ±‚
6. **é‡è¯•å®¹é”™**: åœ¨å¤±è´¥æ—¶æ‰§è¡Œé‡è¯•å’Œå®¹é”™ç­–ç•¥
7. **å“åº”å¤„ç†**: æ¥æ”¶å¹¶è§£ææœåŠ¡æä¾›æ–¹çš„å“åº”
8. **ç»“æœè¿”å›**: å°†å“åº”ç»“æœè¿”å›ç»™è°ƒç”¨æ–¹

### 1.2 è°ƒç”¨æµç¨‹æ—¶åºå›¾
```mermaid
sequenceDiagram
    participant App as åº”ç”¨ä»£ç 
    participant Factory as ServiceProxyFactory
    participant Proxy as ServiceProxy
    participant Registry as æ³¨å†Œä¸­å¿ƒ
    participant LB as è´Ÿè½½å‡è¡¡å™¨
    participant Retry as é‡è¯•æœºåˆ¶
    participant Network as ç½‘ç»œé€šä¿¡
    participant Provider as æœåŠ¡æä¾›è€…

    App->>Factory: getProxy(UserService.class)
    Factory->>Proxy: åˆ›å»ºåŠ¨æ€ä»£ç†
    Factory-->>App: è¿”å›ä»£ç†å¯¹è±¡

    App->>Proxy: userService.getUser(user)
    Proxy->>Registry: serviceDiscovery(serviceKey)
    Registry-->>Proxy: è¿”å›æœåŠ¡å®ä¾‹åˆ—è¡¨

    Proxy->>LB: select(requestParams, serviceList)
    LB-->>Proxy: è¿”å›é€‰ä¸­çš„æœåŠ¡å®ä¾‹

    Proxy->>Retry: doRetry(() -> sendRequest)
    Retry->>Network: å‘é€RPCè¯·æ±‚
    Network->>Provider: è½¬å‘è¯·æ±‚
    Provider-->>Network: è¿”å›å“åº”
    Network-->>Retry: è¿”å›å“åº”
    Retry-->>Proxy: è¿”å›æœ€ç»ˆå“åº”
    Proxy-->>App: è¿”å›ä¸šåŠ¡ç»“æœ
```

## ğŸ­ 2. JDKåŠ¨æ€ä»£ç†å®ç°

### 2.1 ä¸ºä»€ä¹ˆé€‰æ‹©JDKåŠ¨æ€ä»£ç†

JDKåŠ¨æ€ä»£ç†æ˜¯Javaå†…ç½®çš„ä»£ç†æœºåˆ¶ï¼Œåœ¨Ming RPC Frameworkä¸­é€‰æ‹©å®ƒçš„åŸå› ï¼š

1. **é›¶ä¾èµ–**: ä½œä¸ºJDKæ ‡å‡†åº“ï¼Œæ— éœ€å¼•å…¥é¢å¤–ä¾èµ–
2. **åŠ¨æ€æ€§**: è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œæ”¯æŒä»»æ„æ¥å£
3. **æ€§èƒ½ä¼˜ç§€**: åŸºäºå­—èŠ‚ç ç”Ÿæˆï¼Œæ€§èƒ½ä¼˜äºåå°„è°ƒç”¨
4. **ç±»å‹å®‰å…¨**: ä¿æŒå¼ºç±»å‹æ£€æŸ¥ï¼Œç¼–è¯‘æ—¶å‘ç°é”™è¯¯
5. **ç®€æ´é«˜æ•ˆ**: å®ç°ä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤

### 2.2 ServiceProxyFactoryä»£ç†å·¥å‚

#### æ ¸å¿ƒå®ç°
**æ–‡ä»¶è·¯å¾„**: `rpc-core/src/main/java/com/ming/rpc/proxy/ServiceProxyFactory.java`

```java
/**
 * æœåŠ¡ä»£ç†å·¥å‚ï¼ˆå·¥å‚æ¨¡å¼ï¼Œç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡ï¼‰
 */
public class ServiceProxyFactory {

    /**
     * è·å–æœåŠ¡ä»£ç†å¯¹è±¡
     */
    public static <T> T getProxy(Class<T> serviceClass) {
        // æ ¹æ®é…ç½®å†³å®šè¿”å›Mockä»£ç†è¿˜æ˜¯çœŸå®ä»£ç†
        if (RpcApplication.getRpcConfig().isMock()) {
            return getMockProxy(serviceClass);
        }

        return (T) Proxy.newProxyInstance(
            serviceClass.getClassLoader(),
            new Class[] { serviceClass },
            new ServiceProxy()
        );
    }

    /**
     * æ ¹æ®æœåŠ¡ç±»è·å–Mockä»£ç†å¯¹è±¡
     */
    public static <T> T getMockProxy(Class<T> serviceClass) {
        return (T) Proxy.newProxyInstance(
            serviceClass.getClassLoader(),
            new Class[] { serviceClass },
            new MockServiceProxy()
        );
    }
}
```

### 2.3 ServiceProxyåŠ¨æ€ä»£ç†å¤„ç†å™¨

#### æ ¸å¿ƒå®ç°
**æ–‡ä»¶è·¯å¾„**: `rpc-core/src/main/java/com/ming/rpc/proxy/ServiceProxy.java`

```java
/**
 * æœåŠ¡ä»£ç†ï¼ˆJDKåŠ¨æ€ä»£ç†ï¼‰
 */
public class ServiceProxy implements InvocationHandler {

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // æ„é€ RPCè¯·æ±‚
        String serviceName = method.getDeclaringClass().getName();
        RpcRequest rpcRequest = RpcRequest.builder()
            .serviceName(serviceName)
            .methodName(method.getName())
            .parameterTypes(method.getParameterTypes())
            .args(args)
            .build();

        // ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡æä¾›è€…è¯·æ±‚åœ°å€
        RpcConfig rpcConfig = RpcApplication.getRpcConfig();
        Registry registry = RegistryFactory.getInstance(rpcConfig.getRegistryConfig().getRegistry());
        ServiceMetaInfo serviceMetaInfo = new ServiceMetaInfo();
        serviceMetaInfo.setServiceName(serviceName);
        serviceMetaInfo.setServiceVersion(RpcConstant.DEFAULT_SERVICE_VERSION);
        List<ServiceMetaInfo> serviceMetaInfoList = registry.serviceDiscovery(serviceMetaInfo.getServiceKey());

        if (CollUtil.isEmpty(serviceMetaInfoList)) {
            throw new RuntimeException("æš‚æ— æœåŠ¡åœ°å€");
        }

        // è´Ÿè½½å‡è¡¡
        LoadBalancer loadBalancer = LoadBalancerFactory.getInstance(rpcConfig.getLoadBalancer());
        Map<String, Object> requestParams = new HashMap<>();
        requestParams.put("methodName", rpcRequest.getMethodName());
        ServiceMetaInfo selectedServiceMetaInfo = loadBalancer.select(requestParams, serviceMetaInfoList);

        // å‘é€RPCè¯·æ±‚ï¼ˆåŒ…å«é‡è¯•å’Œå®¹é”™æœºåˆ¶ï¼‰
        RpcResponse rpcResponse;
        try {
            RetryStrategy retryStrategy = RetryStrategyFactory.getInstance(rpcConfig.getRetryStrategy());
            rpcResponse = retryStrategy.doRetry(() ->
                    VertexTcpClient.doRequest(rpcRequest, selectedServiceMetaInfo)
            );
        } catch (Exception e) {
            // å®¹é”™æœºåˆ¶
            TolerantStrategy tolerantStrategy = TolerantStrategyFactory.getInstance(rpcConfig.getTolerantStrategy());
            rpcResponse = tolerantStrategy.doTolerant(null, e);
        }

        return rpcResponse.getData();
    }
}
```

### 2.4 é™æ€ä»£ç†å®ç°ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰

#### UserServiceProxyé™æ€ä»£ç†
**æ–‡ä»¶è·¯å¾„**: `example-consumer/src/main/java/com/ming/example/consumer/client/proxy/UserServiceProxy.java`

```java
/**
 * é™æ€ä»£ç†å®ç°ï¼ˆç”¨äºæ¼”ç¤ºå¯¹æ¯”ï¼‰
 */
public class UserServiceProxy implements UserService {

    @Override
    public User getUser(User user) {
        System.out.println("å¼€å§‹è°ƒç”¨è¿œç¨‹æœåŠ¡...");

        // åºåˆ—åŒ–è¯·æ±‚
        Serializer serializer = new JdkSerializer();
        RpcRequest rpcRequest = RpcRequest.builder()
                .serviceName(UserService.class.getName())
                .methodName("getUser")
                .parameterTypes(new Class[]{User.class})
                .args(new Object[]{user})
                .build();

        try {
            byte[] bodyBytes = serializer.serialize(rpcRequest);
            byte[] result;

            // å‘é€HTTPè¯·æ±‚
            try(HttpResponse httpResponse = HttpRequest.post("http://localhost:8080")
                .body(bodyBytes)
                .execute()){
                result = httpResponse.bodyBytes();
            }

            // ååºåˆ—åŒ–å“åº”
            RpcResponse rpcResponse = serializer.deserialize(result, RpcResponse.class);
            return (User) rpcResponse.getData();

        } catch(Exception e) {
            throw new RuntimeException("RPCè°ƒç”¨å¤±è´¥", e);
        }
    }
}
```

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // å¤„ç†Objectç±»çš„æ–¹æ³•
        if (method.getDeclaringClass() == Object.class) {
            return method.invoke(this, args);
        }
        
        // æ„å»ºRPCè¯·æ±‚
        RpcRequest rpcRequest = RpcRequest.builder()
                .serviceName(serviceClass.getName())
                .methodName(method.getName())
                .parameterTypes(method.getParameterTypes())
                .args(args)
                .build();
        
        // å‘é€è¯·æ±‚å¹¶è·å–å“åº”
        RpcResponse rpcResponse = httpClient.sendRequest(rpcRequest, host, port);
        
        // å¤„ç†å¼‚å¸¸
        if (rpcResponse.getException() != null) {
            throw rpcResponse.getException();
        }
        
        // è¿”å›ç»“æœ
        return rpcResponse.getData();
    }
}
```

### 2.3 å·¥ä½œåŸç†

JDKåŠ¨æ€ä»£ç†çš„å·¥ä½œåŸç†æ˜¯ï¼š

1. **åˆ›å»ºä»£ç†ç±»**ï¼šé€šè¿‡`Proxy.newProxyInstance()`æ–¹æ³•åˆ›å»ºå®ç°æŒ‡å®šæ¥å£çš„ä»£ç†ç±»å®ä¾‹
2. **æ–¹æ³•æ‹¦æˆª**ï¼šå½“è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œè°ƒç”¨ä¼šè¢«è½¬å‘åˆ°`InvocationHandler`çš„`invoke`æ–¹æ³•
3. **è¯·æ±‚å¤„ç†**ï¼šåœ¨`invoke`æ–¹æ³•ä¸­ï¼Œå°†æ–¹æ³•è°ƒç”¨ä¿¡æ¯ï¼ˆæ–¹æ³•åã€å‚æ•°ç­‰ï¼‰è½¬æ¢ä¸ºRPCè¯·æ±‚
4. **è¿œç¨‹è°ƒç”¨**ï¼šé€šè¿‡HTTPå®¢æˆ·ç«¯å‘é€RPCè¯·æ±‚åˆ°æœåŠ¡æä¾›æ–¹
5. **ç»“æœå¤„ç†**ï¼šæ¥æ”¶æœåŠ¡æä¾›æ–¹çš„å“åº”ï¼Œå¹¶è¿”å›ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸

## 3. å·¥å‚æ¨¡å¼çš„åº”ç”¨

### 3.1 ä¸ºä»€ä¹ˆé€‰æ‹©å·¥å‚æ¨¡å¼

å·¥å‚æ¨¡å¼åœ¨é¡¹ç›®ä¸­çš„ä¸»è¦ä½œç”¨æ˜¯å°è£…ä»£ç†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€‚é€‰æ‹©å·¥å‚æ¨¡å¼çš„åŸå› åŒ…æ‹¬ï¼š

1. **ç®€åŒ–åˆ›å»ºè¿‡ç¨‹**ï¼šéšè—ä»£ç†å¯¹è±¡åˆ›å»ºçš„å¤æ‚æ€§ï¼Œæä¾›ç®€å•çš„æ¥å£
2. **å°è£…å˜åŒ–ç‚¹**ï¼šå°†å¯èƒ½å˜åŒ–çš„ä»£ç†åˆ›å»ºé€»è¾‘å°è£…åœ¨å·¥å‚ä¸­ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å—å½±å“
3. **ç»Ÿä¸€ç®¡ç†**ï¼šé›†ä¸­ç®¡ç†ä»£ç†å¯¹è±¡çš„åˆ›å»ºï¼Œä¾¿äºæœªæ¥æ‰©å±•å’Œç»´æŠ¤
4. **æé«˜å¯æµ‹è¯•æ€§**ï¼šä¾¿äºåœ¨æµ‹è¯•ä¸­mockæˆ–æ›¿æ¢ä»£ç†å·¥å‚

### 3.2 å…·ä½“å®ç°

`ServiceProxyFactory`ç±»å®ç°äº†å·¥å‚æ¨¡å¼ï¼š

```java
public class ServiceProxyFactory {
    /**
     * åˆ›å»ºæœåŠ¡ä»£ç†ï¼ˆä½¿ç”¨é»˜è®¤ä¸»æœºåå’Œç«¯å£ï¼‰
     */
    public static <T> T getProxy(Class<T> serviceClass) {
        return (T) Proxy.newProxyInstance(
            serviceClass.getClassLoader(),
            new Class[]{serviceClass},
            new ServiceProxy());
    }

    /**
     * åˆ›å»ºæœåŠ¡ä»£ç†
     */
    public static <T> T getProxy(Class<T> serviceClass, String host, int port) {
        HttpClient httpClient = new HttpClient();
        
        return (T) Proxy.newProxyInstance(
                serviceClass.getClassLoader(),
                new Class[]{serviceClass},
                new ServiceInvocationHandler(httpClient, serviceClass, host, port)
        );
    }
}
```

### 3.3 å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹

æ¶ˆè´¹æ–¹åªéœ€é€šè¿‡å·¥å‚æ–¹æ³•è·å–ä»£ç†ï¼Œç„¶ååƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ä½¿ç”¨ï¼š

```java
// è·å–æœåŠ¡ä»£ç†
UserService userService = ServiceProxyFactory.getProxy(UserService.class);

// åˆ›å»ºå‚æ•°
User user = new User();
user.setName("å¼ ä¸‰");

// è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·
User result = userService.getUser(user);
```

## 4. ä¸¤ç§è®¾è®¡æ¨¡å¼çš„ç»“åˆä¼˜åŠ¿

JDKåŠ¨æ€ä»£ç†å’Œå·¥å‚æ¨¡å¼çš„ç»“åˆä½¿ç”¨å¸¦æ¥äº†å¤šé‡ä¼˜åŠ¿ï¼š

### 4.1 å°è£…å¤æ‚æ€§

å·¥å‚æ¨¡å¼å°è£…äº†åŠ¨æ€ä»£ç†åˆ›å»ºçš„å¤æ‚æ€§ï¼Œå®¢æˆ·ç«¯åªéœ€å…³æ³¨æ¥å£è°ƒç”¨ï¼Œä¸éœ€è¦äº†è§£åº•å±‚å®ç°ç»†èŠ‚ã€‚

### 4.2 æé«˜å¯ç»´æŠ¤æ€§

å°†ä»£ç†åˆ›å»ºé€»è¾‘é›†ä¸­åœ¨å·¥å‚ç±»ä¸­ï¼Œä¾¿äºç»Ÿä¸€ç»´æŠ¤å’Œå‡çº§ã€‚å¦‚æœéœ€è¦æ›´æ”¹ä»£ç†å®ç°ï¼ˆå¦‚ä»JDKä»£ç†åˆ‡æ¢åˆ°CGLIBä»£ç†ï¼‰ï¼Œåªéœ€ä¿®æ”¹å·¥å‚ç±»ï¼Œè€Œä¸å½±å“å®¢æˆ·ç«¯ä»£ç ã€‚

### 4.3 çµæ´»é…ç½®

å·¥å‚æ–¹æ³•å¯ä»¥æä¾›å¤šä¸ªé‡è½½ç‰ˆæœ¬ï¼Œæ”¯æŒä¸åŒçš„é…ç½®é€‰é¡¹ï¼ˆå¦‚è‡ªå®šä¹‰ä¸»æœºå’Œç«¯å£ï¼‰ï¼Œå¢åŠ äº†æ¡†æ¶çš„çµæ´»æ€§ã€‚

### 4.4 ä»£ç è§£è€¦

å®¢æˆ·ç«¯ä»£ç ä¸ç½‘ç»œä¼ è¾“ã€åºåˆ—åŒ–ç­‰åº•å±‚å®ç°å®Œå…¨è§£è€¦ï¼Œéµå¾ªäº†"ä¾èµ–å€’ç½®åŸåˆ™"ã€‚

## 5. æ¶ˆè´¹æ–¹è°ƒç”¨çš„å®Œæ•´æµç¨‹å›¾

ä¸‹å›¾å±•ç¤ºäº†æ¶ˆè´¹æ–¹è°ƒç”¨çš„å®Œæ•´æµç¨‹ï¼š

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯ä»£ç 
    participant Factory as ServiceProxyFactory
    participant Proxy as åŠ¨æ€ä»£ç†å¯¹è±¡
    participant Handler as InvocationHandler
    participant HttpClient as HTTPå®¢æˆ·ç«¯
    participant Provider as æœåŠ¡æä¾›æ–¹

    Client->>Factory: getProxy(UserService.class)
    Factory->>Proxy: Proxy.newProxyInstance()
    Factory-->>Client: è¿”å›ä»£ç†å¯¹è±¡
    
    Client->>Proxy: userService.getUser(user)
    Proxy->>Handler: invoke(proxy, method, args)
    
    Handler->>Handler: æ„å»ºRpcRequest
    Handler->>HttpClient: sendRequest(rpcRequest, host, port)
    
    HttpClient->>Provider: HTTP POSTè¯·æ±‚
    Provider->>Provider: å¤„ç†è¯·æ±‚
    Provider-->>HttpClient: è¿”å›RpcResponse
    
    HttpClient-->>Handler: è¿”å›RpcResponse
    Handler-->>Client: è¿”å›ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸
```

## ğŸ­ 3. å·¥å‚æ¨¡å¼åº”ç”¨

### 3.1 å·¥å‚æ¨¡å¼çš„ä»·å€¼

åœ¨Ming RPC Frameworkä¸­ï¼Œå·¥å‚æ¨¡å¼ä¸»è¦ä½“ç°åœ¨ServiceProxyFactoryç±»ä¸­ï¼Œå®ƒå°è£…äº†ä»£ç†å¯¹è±¡çš„åˆ›å»ºé€»è¾‘ï¼š

1. **ç»Ÿä¸€åˆ›å»ºå…¥å£**: æä¾›ç»Ÿä¸€çš„ä»£ç†å¯¹è±¡åˆ›å»ºæ¥å£
2. **é…ç½®é©±åŠ¨**: æ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©Mockä»£ç†æˆ–çœŸå®ä»£ç†
3. **å¤æ‚æ€§å°è£…**: éšè—JDKåŠ¨æ€ä»£ç†çš„åˆ›å»ºç»†èŠ‚
4. **æ‰©å±•æ€§æ”¯æŒ**: ä¾¿äºåç»­æ‰©å±•å…¶ä»–ç±»å‹çš„ä»£ç†å®ç°

### 3.2 å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹

#### ç®€å•ä½¿ç”¨
```java
// è·å–æœåŠ¡ä»£ç†ï¼ˆè‡ªåŠ¨æ ¹æ®é…ç½®é€‰æ‹©Mockæˆ–çœŸå®ä»£ç†ï¼‰
UserService userService = ServiceProxyFactory.getProxy(UserService.class);

// åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡
User user = new User();
user.setName("å¼ ä¸‰");
User result = userService.getUser(user);
```

#### Spring Booté›†æˆä½¿ç”¨
```java
@RestController
public class UserController {

    @RpcReference
    private UserService userService; // é€šè¿‡æ³¨è§£è‡ªåŠ¨æ³¨å…¥ä»£ç†å¯¹è±¡

    @GetMapping("/user/{name}")
    public User getUser(@PathVariable String name) {
        User user = new User();
        user.setName(name);
        return userService.getUser(user); // é€æ˜çš„è¿œç¨‹è°ƒç”¨
    }
}
```

## ğŸ“Š 4. æ€§èƒ½åˆ†æä¸ä¼˜åŒ–

### 4.1 åŠ¨æ€ä»£ç†æ€§èƒ½ç‰¹å¾

#### æ€§èƒ½æµ‹è¯•æ•°æ®
| è°ƒç”¨æ–¹å¼ | 100ä¸‡æ¬¡è°ƒç”¨æ—¶é—´ | å†…å­˜å ç”¨ | CPUå ç”¨ | é€‚ç”¨åœºæ™¯ |
|---------|----------------|---------|---------|----------|
| ç›´æ¥è°ƒç”¨ | 15ms | ä½ | ä½ | æœ¬åœ°è°ƒç”¨ |
| é™æ€ä»£ç† | 18ms | ä½ | ä½ | å›ºå®šæ¥å£ |
| JDKåŠ¨æ€ä»£ç† | 25ms | ä¸­ç­‰ | ä¸­ç­‰ | é€šç”¨RPC |
| CGLIBä»£ç† | 35ms | é«˜ | é«˜ | ç±»ä»£ç† |

### 4.2 ä¼˜åŒ–ç­–ç•¥

#### ä»£ç†å¯¹è±¡ç¼“å­˜
```java
public class OptimizedServiceProxyFactory {

    private static final Map<Class<?>, Object> PROXY_CACHE = new ConcurrentHashMap<>();

    @SuppressWarnings("unchecked")
    public static <T> T getProxy(Class<T> serviceClass) {
        return (T) PROXY_CACHE.computeIfAbsent(serviceClass, clazz -> {
            if (RpcApplication.getRpcConfig().isMock()) {
                return getMockProxy(clazz);
            }
            return createRealProxy(clazz);
        });
    }
}
```

## ğŸ“‹ Ming RPC Frameworkæ¶ˆè´¹æ–¹è°ƒç”¨æ€»ç»“

Ming RPC Frameworké€šè¿‡JDKåŠ¨æ€ä»£ç†å’Œå·¥å‚æ¨¡å¼çš„å·§å¦™ç»“åˆï¼Œå®ç°äº†ä¼˜é›…çš„æ¶ˆè´¹æ–¹è°ƒç”¨æœºåˆ¶ï¼š

### ğŸ‰ æ ¸å¿ƒä»·å€¼
- **é€æ˜åŒ–è°ƒç”¨**: åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡
- **å¤æ‚æ€§å°è£…**: éšè—ç½‘ç»œé€šä¿¡ã€åºåˆ—åŒ–ç­‰åº•å±‚ç»†èŠ‚
- **ç»Ÿä¸€å¤„ç†**: åœ¨ä»£ç†å±‚ç»Ÿä¸€å¤„ç†è´Ÿè½½å‡è¡¡ã€å®¹é”™ã€é‡è¯•ç­‰é€»è¾‘
- **ç±»å‹å®‰å…¨**: ä¿æŒå¼ºç±»å‹æ£€æŸ¥ï¼Œé¿å…è¿è¡Œæ—¶ç±»å‹é”™è¯¯

### ğŸ”§ æŠ€æœ¯ç‰¹è‰²
- **JDKåŠ¨æ€ä»£ç†**: é›¶ä¾èµ–ã€é«˜æ€§èƒ½çš„ä»£ç†å®ç°
- **å·¥å‚æ¨¡å¼**: ç»Ÿä¸€çš„ä»£ç†å¯¹è±¡åˆ›å»ºå’Œç®¡ç†
- **é…ç½®é©±åŠ¨**: æ”¯æŒMockæ¨¡å¼å’ŒçœŸå®æ¨¡å¼çš„åŠ¨æ€åˆ‡æ¢
- **Springé›†æˆ**: é€šè¿‡æ³¨è§£å®ç°è‡ªåŠ¨ä»£ç†æ³¨å…¥

### ğŸ’¡ è®¾è®¡ä¼˜åŠ¿
- **é«˜æ€§èƒ½**: JDKåŠ¨æ€ä»£ç†æ€§èƒ½ä¼˜ç§€ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯
- **æ˜“æ‰©å±•**: å·¥å‚æ¨¡å¼ä¾¿äºæ‰©å±•æ–°çš„ä»£ç†å®ç°
- **æ˜“ç»´æŠ¤**: ä»£ç ç»“æ„æ¸…æ™°ï¼ŒèŒè´£åˆ†ç¦»æ˜ç¡®
- **æ˜“æµ‹è¯•**: æ”¯æŒMockæ¨¡å¼ï¼Œä¾¿äºå•å…ƒæµ‹è¯•

### ğŸš€ åº”ç”¨åœºæ™¯
- **å¾®æœåŠ¡æ¶æ„**: æœåŠ¡é—´çš„é€æ˜è°ƒç”¨
- **åˆ†å¸ƒå¼ç³»ç»Ÿ**: è·¨è¿›ç¨‹çš„æœåŠ¡è°ƒç”¨
- **äº‘åŸç”Ÿåº”ç”¨**: å®¹å™¨åŒ–ç¯å¢ƒä¸‹çš„æœåŠ¡é€šä¿¡
- **ä¼ä¸šçº§åº”ç”¨**: å¤§è§„æ¨¡åˆ†å¸ƒå¼ä¸šåŠ¡ç³»ç»Ÿ

é€šè¿‡è¿™ç§è®¾è®¡ï¼ŒMing RPC Frameworkå®ç°äº†å¯¹è¿œç¨‹è°ƒç”¨å¤æ‚æ€§çš„å®Œç¾å°è£…ï¼Œä¸ºå¼€å‘è€…æä¾›äº†ç®€æ´ã€é€æ˜ã€é«˜æ€§èƒ½çš„è¿œç¨‹æœåŠ¡è°ƒç”¨ä½“éªŒã€‚